"use strict";(self.webpackChunk_etherealengine_docs=self.webpackChunk_etherealengine_docs||[]).push([[44633],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),u=a,m=d["".concat(s,".").concat(u)]||d[u]||h[u]||i;return n?o.createElement(m,r(r({ref:t},p),{},{components:n})):o.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,r[1]=l;for(var c=2;c<i;c++)r[c]=n[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},56218:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var o=n(87462),a=(n(67294),n(3905));const i={},r="Projects",l={unversionedId:"concepts/projects_api",id:"concepts/projects_api",title:"Projects",description:"Projects are folders that contain all your custom code, assets and scenes. They",source:"@site/docs/3_concepts/1_projects_api.md",sourceDirName:"3_concepts",slug:"/concepts/projects_api",permalink:"/etherealengine-docs/docs/concepts/projects_api",draft:!1,editUrl:"https://github.com/etherealengine/etherealengine-docs/docs/3_concepts/1_projects_api.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Concepts",permalink:"/etherealengine-docs/docs/concepts/"},next:{title:"Editor & Locations",permalink:"/etherealengine-docs/docs/concepts/editor_scenes_locations"}},s={},c=[{value:"Configuration",id:"configuration",level:2},{value:"Local Install Flow",id:"local-install-flow",level:2},{value:"Graphical Install Flow",id:"graphical-install-flow",level:2},{value:"Updating the Engine Version and Rebuilding Projects",id:"updating-the-engine-version-and-rebuilding-projects",level:3},{value:"Config",id:"config",level:2},{value:"Hooks",id:"hooks",level:3},{value:"Thumbnail",id:"thumbnail",level:3},{value:"Routes",id:"routes",level:3},{value:"Webapp Injection",id:"webapp-injection",level:3},{value:"World Injection",id:"world-injection",level:3},{value:"Services",id:"services",level:3},{value:"Database Seeding",id:"database-seeding",level:3},{value:"i18n",id:"i18n",level:3}],p={toc:c},d="wrapper";function h(e){let{components:t,...i}=e;return(0,a.kt)(d,(0,o.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"projects"},"Projects"),(0,a.kt)("p",null,"Projects are folders that contain all your custom code, assets and scenes. They\nare version controlled using git & github, and can be installed to any deployment\nwith a single click. (more on that in the ",(0,a.kt)("a",{parentName:"p",href:"/etherealengine-docs/docs/concepts/editor_scenes_locations"},"next chapter"),")"),(0,a.kt)("p",null,"Pictured below is an example of 4 projects installed. By default, only the\n",(0,a.kt)("inlineCode",{parentName:"p"},"default-project")," is installed, which in a production environment is read only.\nYou can find the default project under ",(0,a.kt)("inlineCode",{parentName:"p"},"/packages/projects/default-project/")),(0,a.kt)("p",null,"In a production environment, the builder process will install all projects\naccording to the ",(0,a.kt)("inlineCode",{parentName:"p"},"project")," database table and will download files from the\nstorage provider. In a local development environment, the local file system is\nalways the source of truth. Any project folders added or removed from the file\nsystem will be automatically added or removed from the database. This is to\nensure there is no accidental loss of data, as these project folders are all git\nrepositories."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(79801).Z,width:"174",height:"277"})),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"Projects have a few conventions."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"assets/")," is where files uploaded from the editor will be uploaded to")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"public/")," is for hosting public assets, these will be served from the client")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"sceneName.scene.json")," is a scene file")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"sceneName.thumbnail.png")," is an auto-generated scene thumbnail file")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"xrengine.config.ts")," the project configuration, where client routes, database\nmodels, feathers services and the project thumbnail can be defined"))),(0,a.kt)("p",null,"A project must also have a package.json to provide custom dependencies, and to define\nthe project name, project version, and Ethereal Engine version it is known to work with."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"@etherealengine/*")," monorepo dependencies will be symlinked and not needed, but some\npackage managers (such as pnpm) require these to be defined. If so, they should\nbe defined in ",(0,a.kt)("inlineCode",{parentName:"p"},"peerDependencies"),"."),(0,a.kt)("h2",{id:"local-install-flow"},"Local Install Flow"),(0,a.kt)("p",null,"To install a project locally, clone the repository you wish to install to the\n",(0,a.kt)("inlineCode",{parentName:"p"},"/packages/projects/projects/")," folder. You can do this with the follow commands:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cd packages/projects/projects/\ngit clone https://github.com/myorg/myrepo\ncd myrepo \ncode .\n")),(0,a.kt)("p",null,"This will create a folder name ",(0,a.kt)("inlineCode",{parentName:"p"},"myrepo")," which must contain an ",(0,a.kt)("inlineCode",{parentName:"p"},"xrengine.config.ts"),"\nfile, and open the project in a new vscode window (such that git commands can be\nhandled by the new window). All you need to do now to run this project is re-run\nthe stack (with ",(0,a.kt)("inlineCode",{parentName:"p"},"npm run dev"),")."),(0,a.kt)("h2",{id:"graphical-install-flow"},"Graphical Install Flow"),(0,a.kt)("p",null,"Projects can also be installed and managed from the /admin/projects route. You must be\nan admin and must have a linked GitHub account, which can be attained by having your\nGitHub account linked to your Ethereal Engine account by signing in via GitHub.\n(You do not need to have most recently signed in via GitHub, you just have to have\nlinked your GH account at some point)"),(0,a.kt)("p",null,"See ",(0,a.kt)("a",{parentName:"p",href:"/etherealengine-docs/docs/devops_deployment/setup_github_oauth_for_projects"},"the section 'How to set up GitHub to install external projects'"),"\nfor instructions on creating an OAuth app from GitHub, installing it into an Ethereal Engine deployment,\nand authorizing it to have access to your GitHub organizations."),(0,a.kt)("p",null,"Click the 'Add Project' button:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(39119).Z,width:"1920",height:"1040"})),(0,a.kt)("p",null,"You will see text fields for entering the source and destination repositories.\nWhen you click away from the text fields, the URL will be checked both for the\nrepository existing, and for whether you have sufficient permission to access\nthat repository - read permission for the source repo (public repositories are\nalways available), and write or admin permission for the destination repo. If\nyou have never logged into GitHub with your current account, you will not be\nallowed to add or update projects."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(85225).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"For the source repository, after entering the URL, you will also need to select\na branch to pull from. Your options are either the main branch for that repository,\nor a branch that matches the ",(0,a.kt)("inlineCode",{parentName:"p"},"RELEASE_NAME")," of the deployment, e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"dev-deployment")," for\na deployment with the environment variable ",(0,a.kt)("inlineCode",{parentName:"p"},"RELEASE_NAME=dev"),". If ",(0,a.kt)("inlineCode",{parentName:"p"},"RELEASE_NAME")," is not defined, then\n",(0,a.kt)("inlineCode",{parentName:"p"},"local")," is used; this could lead to multiple local installations of the platform conflicting,\nbut one can set ",(0,a.kt)("inlineCode",{parentName:"p"},"RELEASE_NAME")," locally to something else in your .env.local file."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(82861).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"After the branch is selected, you also need to select a tagged commit from that branch,\nor the most recent commit. As of this writing, you must manually tag project commits yourself,\nthough tags are copied over from the source repository when installing or updating a project."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(8625).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"The backend checks that the source and destination repos have the same project.\nThe project name is the ",(0,a.kt)("inlineCode",{parentName:"p"},"name")," field in the project's package.json file.\nIf the destination repo's ",(0,a.kt)("inlineCode",{parentName:"p"},"<RELEASE_NAME>-deployment")," branch is empty or nonexistent, then\nany project can be uploaded to it. If the destination deployment branch is not empty,\nthen it can only be updated with different versions of that project. For example,\nif the destination branch has project ",(0,a.kt)("inlineCode",{parentName:"p"},"example1")," in it, you will not be allowed to\noverwrite it with a project ",(0,a.kt)("inlineCode",{parentName:"p"},"test3"),", only other projects named ",(0,a.kt)("inlineCode",{parentName:"p"},"example1"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(89275).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"You can only install a project with a given name once, and names are ",(0,a.kt)("strong",{parentName:"p"},"case-insensitive"),";\n",(0,a.kt)("inlineCode",{parentName:"p"},"example1")," is seen as the same name as ",(0,a.kt)("inlineCode",{parentName:"p"},"ExamplE1"),". You would need to remove an existing project\nin order to install a different project that has the same name, or rename one of the projects."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(87142).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"When everything is valid, you will be able to click the Submit button, which will install\nthe project."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(50291).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"Adding a project through this interface runs ",(0,a.kt)("inlineCode",{parentName:"p"},"git clone")," in the background, same as above,\nbut will then upload all of the repository's files to the storage provider. These files will then be\ndownloaded and installed to the deployment's file system each time the docker builder\npod runs. This allows full version controlled access for local development flow\nand version locking for production deployment. The source project code will then be force-pushed\nto the branch ",(0,a.kt)("inlineCode",{parentName:"p"},"<RELEASE_NAME>-deployment"),", so make sure that there is no work in that branch\nthat might get overwritten, and make a backup in another branch you do want to save it."),(0,a.kt)("p",null,"The Push to GitHub button will push the current code for that project to the ",(0,a.kt)("inlineCode",{parentName:"p"},"<RELEASE_NAME>-deployment"),"\nbranch if possible; it will ",(0,a.kt)("em",{parentName:"p"},"never")," push to the main branch. If there are merge conflicts, it will instead\nmake a Pull Request on that branch with the changes; it will NOT force-push anything to this branch,\nunlike adding or updating a project."),(0,a.kt)("p",null,"The Update button opens the same drawer as adding a new project, just with the destination repository locked in.\nAssuming everything matches, it will also force-push to the ",(0,a.kt)("inlineCode",{parentName:"p"},"<RELEASE_NAME>-deployment")," branch in the destination\nrepository."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(80226).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"The GitHub Repo Link button also opens this drawer, but you can only select the destination repository, not\nthe source repository, and no code is pushed anywhere. "),(0,a.kt)("p",null,"The remove button will remove the folder containing that project. This will not delete the deployment\nbranch. WARNING: Any uncommitted & unpushed files will be lost."),(0,a.kt)("h3",{id:"updating-the-engine-version-and-rebuilding-projects"},"Updating the Engine Version and Rebuilding Projects"),(0,a.kt)("p",null,"Making changes to a project is not always reflected immediately in the running code. As of this writing,\nproject code is built into the client-side and backend files, and changes to project code require that\nthe codebase be updated. Locally, this just requires you to stop and restart the ",(0,a.kt)("inlineCode",{parentName:"p"},"npm run dev")," command.\nIn a production environment, this requires that the builder process be restarted, so that it can\nrebuild the client and backend code with the new project code."),(0,a.kt)("p",null,"Changes to scenes in projects do not require a rebuild - since they are stored external to the codebase\nin the storage provider, and are downloaded anew by a client each time the scene is loaded, changes to\nscenes will always be immediately available. The act of saving a project will clear any cached version\nof the scene's static files, so the client will get the new version."),(0,a.kt)("p",null,"Additionally, if you want to update the core Ethereal Engine code, you will also need to re-run the builder\nprocess with the new version of the code."),(0,a.kt)("p",null,"In a production environment, click on the button ",(0,a.kt)("inlineCode",{parentName:"p"},"Update Engine/Rebuild"),". A drawer will open with\na selector for the engine version you want to update with. This will be an image in the builder's\nlinked image repository."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(78916).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"After selecting an engine version, if you click Submit now, you will just rebuild with the\nnewly-selected version of the main codebase, plus whatever versions of your projects are currently\nin your linked repositories."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(49619).Z,width:"1920",height:"1080"})),(0,a.kt)("p",null,"If you click on ",(0,a.kt)("inlineCode",{parentName:"p"},"Update projects"),",\nyou can select the source commits for any installed projects that have a destination repo, same as with\nthe Add/Update project drawer. The projects will be updated before the builder is restarted."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(84412).Z,width:"1920",height:"1080"})),(0,a.kt)("h2",{id:"config"},"Config"),(0,a.kt)("p",null,"The ethereal engine config file has the following options:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"export interface ProjectConfigInterface {\n  onEvent?: string\n  thumbnail?: string\n  routes?: {\n    [route: string]: {\n      component: () => Promise<{ default: (props: any) => JSX.Element }>\n      props?: {\n        [x: string]: any\n        exact?: boolean\n      }\n    }\n  }\n  webappInjection?: () => Promise<{ default: (props: any) => void | JSX.Element }>\n  worldInjection?: () => Promise<{ default: (world: World) => Promise<void> }>\n  services?: string\n  databaseSeed?: string\n  settings?: Array<ProjectSettingSchema>\n}\n")),(0,a.kt)("h3",{id:"hooks"},"Hooks"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"onEvent")," property is a relative path string that points to a file which\nmust expose an object with properties as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"export interface ProjectEventHooks {\n  onInstall?: (app: Application) => Promise<any>\n  onUpdate?: (app: Application) => Promise<any>\n  onUninstall?: (app: Application) => Promise<any>\n}\n")),(0,a.kt)("p",null,"These functions are called when the project they belong to are installed,\nupdated (such as scenes saved) or uninstalled respectively. This is used in the\ndefault ethereal engine project to install the default avatars.\nSee ",(0,a.kt)("inlineCode",{parentName:"p"},"/packages/projects/default-project/projectEventHooks.ts"),"."),(0,a.kt)("h3",{id:"thumbnail"},"Thumbnail"),(0,a.kt)("p",null,"This is a URL to a thumbnail for the project."),(0,a.kt)("h3",{id:"routes"},"Routes"),(0,a.kt)("p",null,"Routes enable users to customise the various URL paths of their website\nutilising dynamic loading of modules. The key of each object represents the path\n(with leading forward slash included) while the value represents a react\ncomponent object which gets wrapped in ",(0,a.kt)("inlineCode",{parentName:"p"},"React.lazy()")," and a props object which\npasses options into the react-dom-router Route component corresponding to the route."),(0,a.kt)("h3",{id:"webapp-injection"},"Webapp Injection"),(0,a.kt)("p",null,"Webapp injection allows logic to be run on all pages, loaded before any routes\nare loaded. This will soon be extended to allow easy stylesheet injection and\nother configurables of the webapp."),(0,a.kt)("h3",{id:"world-injection"},"World Injection"),(0,a.kt)("p",null,"World injection allows logic to be run every time a new world is created,\ncurrently only when the engine is initialised. This is loaded on all instances\nof the engine, such as a location and the editor. An example use case of this\nwould be registering custom scene loader and editor prefabs."),(0,a.kt)("h3",{id:"services"},"Services"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"services")," property is a relative path that points to a file which must\nreturn type ",(0,a.kt)("inlineCode",{parentName:"p"},"((app: Application) => Promise<any>)[]")," which is run on all\ninstanceservers and api servers at startup. This allows users to expose custom\nFeathers services, or whatever other functionality they made need."),(0,a.kt)("h3",{id:"database-seeding"},"Database Seeding"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"databaseSeed")," property is a relative path that points to a file which must\nreturn type ",(0,a.kt)("inlineCode",{parentName:"p"},"ServicesSeedConfig")," from ",(0,a.kt)("inlineCode",{parentName:"p"},"../packages/common/src/interfaces/ServicesSeedConfig.ts"),"\nwhich is run when the database seeder is run. This can be useful for setting\ncustom locations, which can be seen in the\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/etherealengine/demo-etherealengine-project"},"Ethereal Engine demo project"),"."),(0,a.kt)("h3",{id:"i18n"},"i18n"),(0,a.kt)("p",null,"Internationalization can be added using the pattern ",(0,a.kt)("inlineCode",{parentName:"p"},"./i18n/<language>/<namespace>.json"),". An example of the format can be found in ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/etherealengine/etherealengine/tree/dev/packages/client-core/i18n"},"the base i18n files"),"."))}h.isMDXComponent=!0},78916:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-engine-update-select-tag-495c569346f75bc77c22b762bdc664ee.png"},49619:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-engine-update-solo-9a8529ff5cb6aa3a1b3b523c4585cd41.png"},84412:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-engine-update-with-projects-48b9b5506d26ec5f650d31696880f71e.png"},85225:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-install-invalid-source-87a2235c4be1290b975a54910728b75d.png"},89275:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-install-mismatched-projects-301319ef4876a3a73a45a85520bfb0f2.png"},39119:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-install-new-19a99e0335d44e759db93ec2db3d81d4.png"},87142:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-install-project-exists-088411ef3c1b7b20573aefdb78e824eb.png"},82861:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-install-select-branch-1cf5e7be7c551f945a66c80db20192d4.png"},8625:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-install-select-tag-c77972e29712181c6980af2735b2ed9e.png"},50291:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-install-valid-submit-a58244cdac6f366cf328d5db66647edd.png"},80226:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-admin-update-valid-submit-b30dc179bcd24c536b888458306a65ae.png"},79801:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/projects-folder-4865f639203f0b2dd7c83530e1ac7a41.png"}}]);